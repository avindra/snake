(()=>{var d={up:38,down:40,left:37,right:39,enter:13,R:82,H:72,J:74,K:75,L:76,space:32},H=e=>{let t=K.indexOf(e);return t!==-1?S[t]:e},K=[d.K,d.H,d.L,d.J],S=[d.up,d.left,d.right,d.down],D=[...S,...K],i=d;var T=class{constructor(){this.x=0;this.y=0}move(t,o){this.x=t,this.y=o}equals(t){return this.x===t.x&&this.y===t.y}},y=T;var X=e=>e+1,_=e=>e-1,O=class{constructor(){this.points=[new y],this.headed=i.right,this.tail=0,this.alive=!0}getHead(){return this.points[0]}consume(){this.points.push(Object.assign({},this.getHead())),++this.tail}tick(){let{up:t,left:o,right:n,down:r}=i,s=this.getHead(),a=new y;a.move(s.x,s.y);let u;switch(this.headed){case t:case o:u=_;break;case r:case n:u=X;break}let l;switch(this.headed){case t:case r:l="y";break;case o:case n:l="x";break}return a[l]=u(a[l]),this.points.unshift(a),this.points.pop(),this.points.slice(1).forEach(p=>{p.x===a.x&&p.y===a.y&&(this.alive=!1)}),a}};var W=O;var f,x,v=-1,I=!0;typeof AudioContext=="function"&&(f=new AudioContext,x=f.createGain(),x.gain.value=.3,x.connect(f.destination));var $=[16.35,18.35,20.6,21.83,24.5,27.5,30.87,32.7];function R(){if(!f)return;let e=f.createOscillator(),t=f.createOscillator();I?(++v,v===$.length-1&&(I=!1)):(--v,v===0&&(I=!0));let o=$[v]*10;e.frequency.value=o,e.type="sawtooth",t.frequency.value=o,t.type="triangle",e.connect(x),t.connect(x),e.start(f.currentTime),t.start(f.currentTime),e.stop(f.currentTime+.25),t.stop(f.currentTime+.25)}var h;(function(e){e[e.INTRO=0]="INTRO",e[e.INGAME=1]="INGAME",e[e.DEAD=2]="DEAD"})(h||(h={}));function k(e,t){let{floor:o,random:n}=Math;return o(n()*(t-e+1))+e}var M=(e,t)=>{let o=[[[0,0],i.right],[[0,0],i.down],[[e-1,0],i.left],[[e-1,0],i.down],[[0,t-1],i.up],[[0,t-1],i.right],[[e-1,t-1],i.up],[[e-1,t-1],i.left]];return()=>{let n=o[k(0,o.length-1)],r=new y;return r.move(n[0][0],n[0][1]),[r,n[1]]}};var Q=(e=0,t=0)=>{let o=M(e,t),[n,r]=o(),s=new W;return s.points[0]=n,s.headed=r,{screen:h.INTRO,player:s,food:new y,width:e,height:t}};function Z(e,t){let{points:o}=e;for(let n=0;n<o.length;++n)if(o[n].equals(t))return!0;return!1}function q(e){let{width:t,height:o}=e,n;do n=new y,n.move(k(0,t-1),k(0,o-1));while(Z(e.player,n));e.food.move(n.x,n.y),++e.player.tail}function z(e){let{player:t}=e,o=t.getHead();o.x===e.food.x&&o.y===e.food.y&&(q(e),t.consume(),R());let n=t.tick(),{x:r,y:s}=n;return r<0||s<0||r>e.width-1||s>e.height-1?(t.alive=!1,!1):!0}function A(e,t){let o=Q(e,t);return o.width=e,o.height=t,q(o),o}var E=!1,G=(e,t)=>{if(E){t.restore();return}let o=50,n=r=>{let s=r*e;return o+=s,s};t.font=`${n(1.5)}px sans-serif`,t.strokeText("Snake",10,o,2.5*e),t.font=`${n(.7)}px Arial`,t.fillText("by avindra",65,o),t.font=`${n(.55)}px Arial`,t.fillText("Use arrow keys to move.",10,o),t.font=`${n(.85)}px Arial`,t.fillText("Press ENTER to start",10,o),E||(t.save(),E=!0)};var F=(e,t,o)=>{let n=50,r=s=>{let a=s*e;return n+=a,a};t.font=`${r(1.3)}px Arial`,t.fillText("Game over",10,n),t.font=`${r(.9)}px Arial`,t.fillText(`Your final score is ${o}`,17,n),t.font=`${r(.7)}px Arial`,t.fillText("press Enter to play again",10,n)};var L=(e,t,o,n)=>{let{player:r,food:s}=t;e.fillStyle="black",e.fillRect(0,0,o.width,o.height);let{alive:a}=r;e.fillStyle=a?"red":"white",e.fillRect(s.x*n,s.y*n,n,n),e.fillStyle=a?"white":"red",r.points.forEach(g=>e.fillRect(g.x*n,g.y*n,n,n));let u=r.getHead();e.fillStyle="green";let l=0,p=u.x*n,c=u.y*n,m=n/5,w=n-m;switch((r.headed===i.down||r.headed===i.right)&&(l=w),r.headed){case i.down:case i.up:e.fillRect(p,c+l,m,m),e.fillRect(p+w,c+l,m,m);break;case i.right:case i.left:e.fillRect(p+l,c,m,m),e.fillRect(p+l,c+w,m,m);break;default:throw new Error("wat")}let b=r.points.length-1;a?z(t):F(n,e,b)};var ee=50,te=!("requestAnimationFrame"in self),j=(e,t,o,n,r)=>{let s=A(t,o),a=e.getContext("2d"),u=()=>{let c=s.screen;c===h.INTRO?G(n,a):c===h.INGAME&&L(a,s,e,n)},l=te?()=>{u(),r()}:()=>{requestAnimationFrame(u)},p=c=>{let{keyCode:m}=c,{player:w}=s,b=H(m),g=b==i.enter,J=b==i.space,V=b===i.R,Y=!w.alive&&(g||J);(V||g)&&(Y&&(s=A(t,o)),s.screen=h.INGAME),D.find(U=>U===b)&&(c.preventDefault(),w.headed=b)};return e.width=t*n,e.height=o*n,window.onkeydown=p,()=>setInterval(l,ee)};var ne=e=>document.getElementById(e),C=ne("game"),Me=C.getContext("2d"),B=20,P=20,N=window.innerHeight/P;C.width=B*N;C.height=P*N;var oe=j(C,B,P,N);oe();})();
